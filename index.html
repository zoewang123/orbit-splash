<!doctype html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Orbit Swap</title>
<style>
html,body{margin:0;height:100%;background:#000;overflow:hidden;font-family:"Trebuchet MS",Verdana,sans-serif}
canvas{display:block;touch-action:manipulation}
</style>
<canvas id="c"></canvas>
<script>
const c=document.getElementById("c"),x=c.getContext("2d");
let w,h,cx,cy,r1,r2,dpr=1,obs=[],gems=[],orbit=0,score=0,state=0,last=0,spawnT=0,shake=0;
const TAU=Math.PI*2;
function resize(){
  dpr=devicePixelRatio||1;
  w=innerWidth;h=innerHeight;
  c.width=w*dpr;c.height=h*dpr;
  c.style.width=w+"px";c.style.height=h+"px";
  x.setTransform(dpr,0,0,dpr,0,0);
  cx=w/2;cy=h/2;
  r1=Math.min(w,h)*0.18;
  r2=r1*1.8;
}
addEventListener("resize",resize);resize();
function reset(){
  obs=[];gems=[];orbit=0;score=0;spawnT=0;state=1;shake=0;
}
function tap(){
  if(state===0)reset();
  else if(state===2)reset();
  else orbit=1-orbit;
}
addEventListener("pointerdown",tap);
addEventListener("keydown",e=>{if(e.key===" "||e.key==="ArrowUp"||e.key==="ArrowDown")tap();});
function spawn(){
  const a=3.2+Math.random()*2.6,o=Math.random()<.5?0:1;
  if(Math.random()<.22)gems.push({a,o});
  else obs.push({a,o});
}
function drawText(t,y,s){
  x.fillStyle="rgba(255,255,255,.9)";
  x.font=(s||24)+"px \"Trebuchet MS\",Verdana,sans-serif";
  x.textAlign="center";x.fillText(t,cx,y);
}
function loop(t){
  requestAnimationFrame(loop);
  const dt=Math.min(.033,(t-last||0)/1e3);last=t||0;
  if(state===1){
    const speed=1.6+score*0.02;
    spawnT-=dt;if(spawnT<=0){spawn();spawnT=.55+Math.random()*.35-Math.min(.35,score*.002);}
    for(let i=obs.length-1;i>=0;i--){
      const o=obs[i];o.a-=speed*dt;
      if(o.a<-0.4)obs.splice(i,1);
      else if(Math.abs(o.a)<.12&&o.o===orbit){state=2;shake=12;}
    }
    for(let i=gems.length-1;i>=0;i--){
      const g=gems[i];g.a-=speed*dt;
      if(g.a<-0.4)gems.splice(i,1);
      else if(Math.abs(g.a)<.12&&g.o===orbit){score+=3;gems.splice(i,1);}
    }
    score+=dt;
  }
  x.clearRect(0,0,w,h);
  const g=x.createRadialGradient(cx,cy,0,cx,cy,Math.max(w,h));
  g.addColorStop(0,"#08141f");g.addColorStop(1,"#000");
  x.fillStyle=g;x.fillRect(0,0,w,h);
  if(shake>0){shake-=dt*30;x.translate((Math.random()-.5)*shake,(Math.random()-.5)*shake);}
  x.strokeStyle="rgba(80,220,255,.18)";x.lineWidth=2;
  x.beginPath();x.arc(cx,cy,r1,0,TAU);x.arc(cx,cy,r2,0,TAU);x.stroke();
  const pulse=.02+Math.sin(t/500)*.01;
  function drawDot(a,o,col,rad){
    const r=o?r2:r1,px=cx+Math.sin(a)*r,py=cy-Math.cos(a)*r;
    x.fillStyle=col;x.beginPath();x.arc(px,py,rad,0,TAU);x.fill();
  }
  for(const o of obs)drawDot(o.a,o.o,"#ff6b6b",7);
  for(const g of gems)drawDot(g.a,g.o,"#7dffb3",5);
  const pr=orbit?r2:r1;
  x.shadowBlur=18;x.shadowColor="rgba(120,220,255,.6)";
  drawDot(0,orbit,"#fff",7+pr*pulse);
  x.shadowBlur=0;
  x.fillStyle="rgba(255,255,255,.8)";
  x.font="16px \"Trebuchet MS\",Verdana,sans-serif";x.textAlign="left";
  x.fillText("Score "+(score|0),12,24);
  if(state===0){
    drawText("Orbit Swap",cy-20,36);
    drawText("Tap to switch rings",cy+20,18);
  }else if(state===2){
    drawText("Crash!",cy-20,34);
    drawText("Tap to retry",cy+18,18);
  }
  x.setTransform(dpr,0,0,dpr,0,0);
}
requestAnimationFrame(loop);
</script>
